sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt \
$(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'

wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -


sudo apt update


sudo apt install postgresql-client-17






docker build --no-cache -t undrr/datum-ai-vector-worker:0.0.2-arm64 .
docker push undrr/datum-ai-vector-worker:0.0.2-arm64

docker build --no-cache -t undrr/datum-ai-vector-worker:0.0.2-amd64 .
docker push undrr/datum-ai-vector-worker:0.0.2-amd64

docker manifest create undrr/datum-ai-vector-worker:0.0.2 --amend undrr/datum-ai-vector-worker:0.0.2-amd64 --amend undrr/datum-ai-vector-worker:0.0.2-arm64
docker manifest push undrr/datum-ai-vector-worker:0.0.2

docker manifest create undrr/datum-ai-vector-worker:latest --amend undrr/datum-ai-vector-worker:0.0.2-amd64 --amend undrr/datum-ai-vector-worker:0.0.2-arm64
docker manifest push undrr/datum-ai-vector-worker:latest



env PYTHONPATH=/data python3 src/task_datum_enriched_content.py --cluster preventionweb --collection events --version 1.0.0 --limit 5 --latest


env PYTHONPATH=/data python3 src/task_chunk_content_v1.py \
            --cluster_id preventionweb --collection_id news \
            --version 1.0.0 --article-limit 10 --latest --latest-max-pages 3


/opt/venv/bin/python3 /data/python/task_datum_enriched_content.py --cluster drupal --collection news --version 1.0.0 --id 101313 --recreate


env PYTHONPATH=/data /usr/local/bin/python3 /data/src/task_datum_enriched_content.py --cluster preventionweb --collection news --version 1.0.0 --limit 50 --latest-new


env PYTHONPATH=/data \
  /usr/local/bin/python3 /data/src/temp_populate_content_checksum.py



SELECT COUNT(*) 
FROM content_chunk_text_embedding_3_small
WHERE cluster_id='preventionweb' 
  AND collection_id='news';

DELETE FROM content_chunk_text_embedding_3_small
WHERE cluster_id = 'preventionweb'
  AND collection_id = 'news'
  AND version = '1.0.0';

env PYTHONPATH=/data python3 src/task_chunk_content.py \
  --cluster_id preventionweb \
  --collection_id news \
  --version 1.0.0 \
  --article-limit 25 \
  --reset \
  --shifted-chunking

